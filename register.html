<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Register - Quantum Apex</title>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body { background:#0f172a; }
.toast {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #1e293b;
  padding: 20px 40px;
  border-radius: 12px;
  box-shadow: 0 0 25px rgba(16,185,129,0.4);
  display: none;
  z-index: 1000;
  text-align:center;
  font-weight:bold;
}
</style>
</head>

<body class="flex items-center justify-center min-h-screen text-white">

<div class="bg-slate-800 p-8 rounded-2xl w-full max-w-md">
<h2 class="text-2xl font-bold mb-6 text-center text-emerald-400">Create Account</h2>

<input id="name" placeholder="Full Name" class="w-full mb-3 p-3 rounded bg-slate-700">
<input id="email" type="email" placeholder="Email" class="w-full mb-3 p-3 rounded bg-slate-700">
<input id="phone" placeholder="Phone Number" class="w-full mb-3 p-3 rounded bg-slate-700">

<select id="country" class="w-full mb-3 p-3 rounded bg-slate-700">
<option value="">Select Country</option>
<option>Kenya</option><option>Uganda</option><option>Tanzania</option>
<option>Rwanda</option><option>Zambia</option><option>Zimbabwe</option>
<option>Botswana</option><option>South Africa</option><option>Mozambique</option>
<option>Ethiopia</option><option>South Sudan</option><option>Nigeria</option>
<option>France</option><option>United Kingdom</option>
</select>

<input id="password" type="password" placeholder="Password" class="w-full mb-3 p-3 rounded bg-slate-700">
<input id="confirmPassword" type="password" placeholder="Confirm Password" class="w-full mb-3 p-3 rounded bg-slate-700">
<input id="referral" placeholder="Referral Code (Optional)" class="w-full mb-4 p-3 rounded bg-slate-700">

<button id="registerBtn" class="w-full bg-emerald-500 py-3 rounded font-semibold">
Register
</button>

<p class="text-center mt-4 text-gray-400">
Already have account? <a href="login.html" class="text-emerald-400">Login</a>
</p>
</div>

<div id="toast" class="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const app = initializeApp({
  apiKey: "AIzaSyDaEphuY2kQue8m-20DDs68JDgQirAycBE",
  authDomain: "digital-wallet-40297.firebaseapp.com",
  databaseURL: "https://digital-wallet-40297-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "digital-wallet-40297"
});

const auth = getAuth(app);
const db = getDatabase(app);

function toast(msg, ok=true){
  const t=document.getElementById("toast");
  t.innerText=msg;
  t.style.display="block";
  t.style.color=ok?"#10b981":"#ef4444";
  setTimeout(()=>t.style.display="none",3000);
}

function genCode(){
  return Math.random().toString(36).substring(2,8).toUpperCase();
}

document.getElementById("registerBtn").onclick = async () => {
  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("email").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const country = document.getElementById("country").value;
  const pass = document.getElementById("password").value;
  const pass2 = document.getElementById("confirmPassword").value;
  const refCode = document.getElementById("referral").value.trim().toUpperCase();

  if(!name||!email||!phone||!country||!pass||!pass2){
    toast("Fill all required fields",false); return;
  }
  if(pass!==pass2){ toast("Passwords do not match",false); return; }

  try{
    const cred = await createUserWithEmailAndPassword(auth,email,pass);
    const uid = cred.user.uid;

    let referredBy = null;
    if(refCode){
      const snap = await get(ref(db,"users"));
      snap.forEach(u=>{
        if(u.val().referralCode===refCode) referredBy=u.key;
      });
    }

    await set(ref(db,"users/"+uid),{
      uid,name,email,phone,country,
      mainBalance:0,lockedBalance:0,referralBalance:0,
      totalDeposited:0,totalProfit:0,totalWithdrawn:0,
      referralCode:genCode(),
      referredBy,
      createdAt:Date.now()
    });

    toast("Account Created");
    setTimeout(()=>location.href="dashboard.html",1200);

  }catch(e){ toast(e.message,false); }
};
</script>
</body>
</html>
