<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Register - Quantum Apex</title>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body { background:#0f172a; }
.toast {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #1e293b;
  padding: 20px 40px;
  border-radius: 12px;
  box-shadow: 0 0 25px rgba(16,185,129,0.4);
  display: none;
  z-index: 1000;
  text-align:center;
  font-weight:bold;
  color:white;
}
</style>
</head>

<body class="flex items-center justify-center min-h-screen text-white">

<div class="bg-slate-800 p-8 rounded-2xl w-full max-w-md">
<h2 class="text-2xl font-bold mb-6 text-center text-emerald-400">Create Account</h2>

<input id="name" type="text" placeholder="Full Name" class="w-full mb-3 p-3 rounded bg-slate-700">
<input id="email" type="email" placeholder="Email" class="w-full mb-3 p-3 rounded bg-slate-700">
<input id="phone" type="text" placeholder="Phone Number" class="w-full mb-3 p-3 rounded bg-slate-700">

<select id="country" class="w-full mb-3 p-3 rounded bg-slate-700">
<option value="">Select Country</option>
<option>Kenya</option>
<option>Uganda</option>
<option>Tanzania</option>
<option>Rwanda</option>
<option>Zambia</option>
<option>Zimbabwe</option>
<option>Botswana</option>
<option>South Africa</option>
<option>Mozambique</option>
<option>Ethiopia</option>
<option>South Sudan</option>
<option>Nigeria</option>
<option>France</option>
<option>United Kingdom</option>
</select>

<input id="password" type="password" placeholder="Password" class="w-full mb-3 p-3 rounded bg-slate-700">
<input id="confirmPassword" type="password" placeholder="Confirm Password" class="w-full mb-3 p-3 rounded bg-slate-700">
<input id="referral" type="text" placeholder="Referral Code (Optional)" class="w-full mb-4 p-3 rounded bg-slate-700">

<button id="registerBtn" class="w-full bg-emerald-500 py-3 rounded hover:bg-emerald-600 font-semibold">
Register
</button>

<p class="text-center mt-4 text-gray-400">
Already have account? <a href="login.html" class="text-emerald-400">Login</a>
</p>
</div>

<div id="toast" class="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDaEphuY2kQue8m-20DDs68JDgQirAycBE",
  authDomain: "digital-wallet-40297.firebaseapp.com",
  databaseURL: "https://digital-wallet-40297-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "digital-wallet-40297",
  storageBucket: "digital-wallet-40297.firebasestorage.app",
  messagingSenderId: "953454788272",
  appId: "1:953454788272:android:961fd704f587cf1b8c8575"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

function showToast(message, success=true) {
  const toast = document.getElementById("toast");
  toast.innerText = message;
  toast.style.display = "block";
  toast.style.border = success ? "2px solid #10b981" : "2px solid red";
  toast.style.color = success ? "#10b981" : "#ef4444";
  setTimeout(() => { toast.style.display = "none"; }, 3000);
}

document.getElementById("registerBtn").addEventListener("click", async () => {
  const nameVal = document.getElementById("name").value.trim();
  const emailVal = document.getElementById("email").value.trim();
  const phoneVal = document.getElementById("phone").value.trim();
  const countryVal = document.getElementById("country").value;
  const passwordVal = document.getElementById("password").value;
  const confirmPasswordVal = document.getElementById("confirmPassword").value;
  const referralVal = document.getElementById("referral").value.trim();

  if(!nameVal || !emailVal || !phoneVal || !countryVal || !passwordVal || !confirmPasswordVal){
    showToast("Please fill in all required fields", false);
    return;
  }

  if(passwordVal !== confirmPasswordVal){
    showToast("Passwords do not match", false);
    return;
  }

  try {
    const userCred = await createUserWithEmailAndPassword(auth, emailVal, passwordVal);
    const user = userCred.user;

    let referredBy = null;
    if(referralVal){
      const refCheck = await get(ref(db, "users/" + referralVal));
      if(refCheck.exists()) referredBy = referralVal;
    }

    await set(ref(db, "users/" + user.uid), {
      uid: user.uid,
      name: nameVal,
      email: emailVal,
      phone: phoneVal,
      country: countryVal,
      mainBalance: 0,
      lockedBalance: 0,
      referralBalance: 0,
      totalDeposited: 0,
      totalProfit: 0,
      totalWithdrawn: 0,
      referralCode: user.uid,
      referredBy: referredBy,
      createdAt: Date.now()
    });

    // âœ… Show success immediately and redirect
    showToast("Account Created Successfully");
    setTimeout(() => window.location.href="dashboard.html", 1500);

  } catch (error) {
    const firebaseErrors = {
      "auth/email-already-in-use": "Email already exists",
      "auth/invalid-email": "Invalid email address",
      "auth/weak-password": "Password too weak"
    };
    showToast(firebaseErrors[error.code] || "Registration failed", false);
  }
});
</script>
</body>
</html>
