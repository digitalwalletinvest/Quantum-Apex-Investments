<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profile - Quantum Apex</title>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body { background:#0f172a; font-family:Inter,sans-serif; color:white; }
.container { max-width: 500px; margin: 2rem auto; padding: 2rem; background:#1e293b; border-radius:14px; }
.field-wrapper { position: relative; margin-bottom: 1.5rem; }
input, select { width: 100%; padding: 0.75rem; border-radius: 8px; background:#0f172a; color:white; border:1px solid #334155; }
input[disabled] { background:#334155; cursor:not-allowed; }
button { padding: 0.75rem; border-radius: 8px; width:100%; font-weight:bold; color:white; margin-top:1rem; }
#saveBtn { background:#10b981; margin-bottom:1rem; }
#saveBtn:hover { background:#059669; cursor:pointer; }
#logout { background:#ef4444; }
#logout:hover { background:#dc2626; cursor:pointer; }
.toast {
  position: fixed;
  bottom: 2rem;
  left: 50%;
  transform: translateX(-50%);
  background:#1e293b;
  padding: 15px 30px;
  border-radius: 12px;
  box-shadow: 0 0 20px rgba(16,185,129,0.5);
  display:none;
  font-weight:bold;
  color:white;
  z-index: 1000;
}
.edit-icon {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  color: #10b981;
  font-size: 1rem;
}
</style>
</head>

<body>

<div class="container">
  <h2 class="text-2xl font-bold mb-6 text-center text-emerald-400">Profile</h2>

  <div class="field-wrapper">
    <label for="name">Name</label>
    <input type="text" id="name" disabled>
    <span class="edit-icon" id="editName">✎</span>
  </div>

  <div class="field-wrapper">
    <label for="email">Email</label>
    <input type="email" id="email" disabled>
  </div>

  <div class="field-wrapper">
    <label for="phone">Phone Number</label>
    <input type="text" id="phone" disabled>
    <span class="edit-icon" id="editPhone">✎</span>
  </div>

  <div class="field-wrapper">
    <label for="country">Country</label>
    <input type="text" id="country" disabled>
  </div>

  <button id="saveBtn">Save Details</button>
  <button id="logout">Logout</button>
</div>

<div id="toast" class="toast"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

// Firebase config
const app = initializeApp({
  apiKey: "AIzaSyDaEphuY2kQue8m-20DDs68JDgQirAycBE",
  authDomain: "digital-wallet-40297.firebaseapp.com",
  databaseURL: "https://digital-wallet-40297-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "digital-wallet-40297"
});

const auth = getAuth(app);
const db = getDatabase(app);

// UI Elements
const nameInput = document.getElementById("name");
const emailInput = document.getElementById("email");
const phoneInput = document.getElementById("phone");
const countryInput = document.getElementById("country");
const logoutBtn = document.getElementById("logout");
const saveBtn = document.getElementById("saveBtn");
const toast = document.getElementById("toast");
const editName = document.getElementById("editName");
const editPhone = document.getElementById("editPhone");

// Toast function
function showToast(msg, success=true){
  toast.innerText = msg;
  toast.style.display = "block";
  toast.style.color = success ? "#10b981" : "#ef4444";
  setTimeout(()=>{ toast.style.display="none"; }, 3000);
}

// Enable editing on clicking pen icon
editName.onclick = () => { nameInput.disabled = false; nameInput.focus(); }
editPhone.onclick = () => { phoneInput.disabled = false; phoneInput.focus(); }

// Real-time Firebase sync
let userRef;
onAuthStateChanged(auth, user => {
  if(!user) location.href = "login.html";
  userRef = ref(db, "users/" + user.uid);

  // Load immediately and update in real-time
  onValue(userRef, snapshot => {
    if(!snapshot.exists()) return;
    const data = snapshot.val();
    nameInput.value = data.name || "";
    emailInput.value = data.email || "";
    phoneInput.value = data.phone || "";
    countryInput.value = data.country || "";
  });
});

// Save button click
saveBtn.onclick = () => {
  const updates = {};
  if(!nameInput.disabled) updates.name = nameInput.value.trim();
  if(!phoneInput.disabled) updates.phone = phoneInput.value.trim();

  if(Object.keys(updates).length === 0){
    showToast("No changes to save", false);
    return;
  }

  update(userRef, updates)
    .then(()=> {
      showToast("Details updated successfully");
      nameInput.disabled = true;
      phoneInput.disabled = true;
    })
    .catch(()=> showToast("Failed to update details", false));
}

// Logout
logoutBtn.onclick = () => signOut(auth).then(()=> location.href="login.html");

</script>
</body>
  </html>
